<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vidéo Synchronisée</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            width: 100%;
            height: 100%;
            background-color: #000;
            color: white;
            font-family: Arial, sans-serif;
        }
        
        #videoContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        #syncButton {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            z-index: 1000;
        }

        #syncButton:hover {
            background: #45a049;
        }

        #status {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="videoContainer">
        <iframe 
            src="https://drive.google.com/file/d/1jiD0I4Ma9u0ToMwAxPWBF1PSRjXTHqEh/preview" 
            allow="autoplay; fullscreen"
            allowfullscreen>
        </iframe>
    </div>
    <button id="syncButton">Synchroniser avec les autres</button>
    <div id="status">En attente...</div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js';
        import { getDatabase, ref, set, onValue } from 'https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAr7CBjRgHScfCV5q8BHj9kYVwfvD9B-JQ",
            authDomain: "videosynch-30d07.firebaseapp.com",
            databaseURL: "https://videosynch-30d07-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "videosynch-30d07",
            storageBucket: "videosynch-30d07.firebasestorage.app",
            messagingSenderId: "350569938685",
            appId: "1:350569938685:web:38c9fbb279871f32c28894"
        };

        // Initialisation
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const videoRef = ref(db, 'video-sync');
        const status = document.getElementById('status');
        const syncButton = document.getElementById('syncButton');

        function updateStatus(message) {
            status.textContent = message;
            status.style.opacity = '1';
            setTimeout(() => status.style.opacity = '0.7', 3000);
        }

        syncButton.addEventListener('click', () => {
            set(videoRef, {
                action: 'sync',
                timestamp: Date.now()
            });
            updateStatus('Synchronisation demandée');
        });

        // Écoute des changements Firebase
        onValue(videoRef, (snapshot) => {
            const data = snapshot.val();
            if (!data) return;

            updateStatus('Synchronisation en cours...');

            // Recharge l'iframe pour tous les utilisateurs
            if (data.action === 'sync') {
                document.querySelector('iframe').src += '';
                updateStatus('Vidéo synchronisée !');
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'f' || e.key === 'F') {
                const elem = document.documentElement;
                if (!document.fullscreenElement) {
                    elem.requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            }
        });

    </script>
</body>
</html>